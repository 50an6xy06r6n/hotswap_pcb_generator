# OpenSCAD Source
`pcb.scad`, `plate.scad`, and `backplate.scad` are the files responsible for generating the actual PCB, plate, and backplate STLs. `keyboard.scad` Just combines all three components so you can preview the final result before you print anything. There's also `diode_bending_template.scad`, which generates a small jig for bending the diode legs repeatably, though the STLs for these are already in the [`stl`](../stl) directory.

 General parameters for the PCB and plate come from `parameters.scad` and layout data comes from `layout.scad`, which is generated by the [conversion script](../script). If `layout.scad` doesn't exist, layout data is taken from `default_layout.scad`, which contains an example layout that takes advantage of most of the available customizations for reference.

 Below are descriptions of all the values that can be customized to suit your needs without breaking the code (I think). File an issue if a customization is broken or you have an idea for a feature.

### Layout Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `base_switch_layout` | Defines position, orientation, and size of each key socket, as well as the size of the border that connects each socket to adjacent ones. For each key, the layout looks like this: <pre>[<br/>&nbsp;&nbsp;[<br/>&nbsp;&nbsp;&nbsp;&nbsp;[x_location, y_location],<br/>&nbsp;&nbsp;&nbsp;&nbsp;key_size,<br/>&nbsp;&nbsp;&nbsp;&nbsp;[rotation, rotation_x, rotation_y]<br/>&nbsp;&nbsp;],<br/>&nbsp;&nbsp;[top_border, bottom_border, left_border, right_border],<br/>&nbsp;&nbsp;extra_data<br/>]</pre>All variables besides `x_location` and `y_location` are optional, though within each grouping values must be defined in order. For switches, border values define multiples of `border_width`, which is calculated from the difference between `socket_size` and `unit`. If you want to define the size of the border in mm, multiply by the `mm` variable, which does the conversion. If you have different vertical and horizontal spacing, use `h_mm` and `v_mm` instead. `extra_data` corresponds to the `rotate_column` parameter in the switch modules, which allows you to rotate the column wire channels for easier routing for things like thumb clusters. | `layout.scad` |
| `base_mcu_layout` | Defines the position of an (optional) microcontroller daughterboard. Data format is identical to that of `base_switch_layout`, though `key_size` should be set to `mcu_h_unit_size`, which is the socket's width in key units calculated from `mcu_width` and `mcu_unit_resolution`. Border values are defined in mm. No `extra_data` is defined. | `layout.scad` |
| `base_trrs_layout` | Defines the position of an (optional) TRRS socket for a split layout. Data format is identical to that of `base_switch_layout`, with the socket pointing upwards. This allows the socket to be properly rotated when using the `invert_layout_flag`. Border values are defined in mm. No `extra_data` is defined. | `layout.scad` |
| `base_standoff_layout` | Defines the position of each (optional) standoff. Data format is identical to that of `base_switch_layout`, with the standoff placed at the center of the key unit. This makes it means that you can place a standoff in between two keys by just averaging their positions. By default, standoffs are configured according to the `standoff_integration_default` and `standoff_attachment_default` parameters defined in `parameters.scad`, but these can be overridden on a per-standoff basis using the `extra_data` parameter. | `layout.scad` |
| `invert_layout_flag` | If set to true, the layout will be inverted when generating the PCB and plate. This is handy for split layouts with identical left and right hands, as it saves you the trouble of copying over any changes you make to the borders and standoff positions. | `layout.scad` |
| `layout_type` | This can be set to either `column` or `row` (depending on the layout stagger), and affects which side the recessed grid is printed on, which is necessary for routing matrix wires that don't run in a straight line. For row-staggered layouts, the grid will be on the bottom (column-side) of the PCB, so it will be easier to print upside down. | `layout.scad` |

### PCB Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `wire_diameter` | The diameter of wire (in mm) used for the matrix. The default value of 2.15 works for 22AWG silicone-sleeved wire, which is what I used, but it can be tweaked based on your fit preferences or a different kind of wire. | `parameters.scad` |
| `diode_pin_angle` | This changes the angle of the channel that forms the bottom switch pin socket. The bottom switch pin makes contact the diode anode leg, and the connection can sometimes be a bit flaky. Slightly angling the channel upwards forces the switch pin into the diode leg as it's inserted, and makes for a more robust connection. This can put a slight bend in the switch pin that can be easily bent back (the bottom pin tends to be the sturdier of the two), but if you don't want that you can set the angle to 0. | `parameters.scad` |
| `pcb_thickness` | Defines the overall thickness of the PCB. This must be at least 4mm, which is the minimum needed to fit both row and column wires. Can be increased if you want a sturdier PCB. | `parameters.scad` |
| `plate_margin` | Defines how far the plate sticks out beyond the PCB. If you wish to have more granular control over the plate shape, you can set this to 0 and generate a separate layout for the plate and edit the borders directly. | `parameters.scad` |

### Switch Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `switch_type` | This can be set to either `mx` or `choc`, depending on the type of switch you plan to use. This changes the PCB cutouts, as well as the plate thickness and spacing used for standoffs. Support for other switch types is possible if I'm able to obtain them. | `parameters.scad` |
| `switch_orientation` | This can be set to either `north` or `south`, and defines the LED orientation of the switch. South-facing offers better compatibility with Cherry-profile keycaps, while north-facing may result in better illumination of shine-through legends (though there is not yet support for LEDs). | `parameters.scad` |

### MCU Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `mcu_type` | This can be set to `bare` or `socketed`, depending on whether your MCU has pins soldered into it. Bare MCUs are a little easier to wire up and are lower-profile. Socketed MCUs are a little more tricky to wire and stick up more, but if you have an MCU salvaged from a previous build it's likely to have the pins already soldered in. | `parameters.scad` |
| `mcu_width` | Width of the daughterboard PCB in mm. Default value of 18 works for Pro Micro footprint. | `parameters.scad` |
| `mcu_length` | Length of the daughterboard PCB in mm. Default value of 33 works for Pro Micro footprint. | `parameters.scad` |
| `mcu_height` | Distance from the top of the daughterboard PCB to the base of the header pins in mm. Default value of 4.25 works for Pro Micro footprint on generic square header pins. Only relevant for socketed MCUs. | `parameters.scad` |
| `mcu_row_spacing` | Center-to-center distance between rows of pins in mm. Default value of 15.24 (0.6 inches) works for Pro Micro footprint. | `parameters.scad` |
| `mcu_row_count` | Number of pin rows. Currently can't be changed from the default value of 2, as I don't know of any boards like that, and it would make the code very complicated. | `parameters.scad` |
| `mcu_pin_count` | Total number of pins on the daughterboard. Default value of 24 works for Pro Micro footprint. | `parameters.scad` |
| `mcu_pin_pitch` | Center-to-center distance between adjacent pins in mm. Default value of 2.54 (0.1 inches) is pretty standard and works for Pro Micro footprint. | `parameters.scad` |
| `mcu_pin_offset` | Offset from the rear of the daughterboard to the boundary of the nearest pin. Default of value of 0 works for Pro Micro footprint. | `parameters.scad` |
| `mcu_connector_width` | Width of the daughterboard connector (for making plate cutouts) in mm. Default value of 10 works for Micro-USB and USB-C connectors. May not be necessary for mid-mount connectors that don't stick very far above the board (i.e. Elite-C). | `parameters.scad` |
| `mcu_connector_length` | Length that the daughterboard connector extends into the board (for making plate cutouts) in mm. Default value of 4 works for Micro-USB and USB-C connectors. May not be necessary for mid-mount connectors that don't stick very far above the board (i.e. Elite-C). | `parameters.scad` |
| `mcu_pcb_thickness` | Thickness of the daughterboard PCB. Default value of 1.6 is pretty standard. | `parameters.scad` |
| `mcu_socket_width` | Width of the socket holding the MCU. Default value of `mcu_width + 4` works pretty well. | `parameters.scad` |
| `mcu_socket_length` | Length of the socket holding the MCU. Default value of `mcu_length + 4` works pretty well. | `parameters.scad` |

### TRRS Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `trrs_width` | Width of the TRRS socket in mm. Default value of 6 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_length` | Length of the TRRS socket in mm (not including the round flange). Default value of 12.1 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_height` | Height of the TRRS socket in mm. Default value of 5 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_flange_length` | Length of the round flange (where the plug inserts) in mm. Default value of 2 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_flange_diameter` | Diameter of the round flange (where the plug inserts) in mm. Default value of 5 works for the popular PJ-320A socket (though this may vary slightly by manufacturer). | `parameters.scad` |
| `trrs_pin_spacing` | Distance between the two rows of pins in mm. Default value of 4.4 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_nub_diameter` | Diameter of the little plastic locating nubs at the bottom of the socket in mm. Default value of 1 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_nub_height` | Height of the little plastic locating nubs at the bottom of the socket in mm. Default value of 1 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_nub_spacing` | Space between the little plastic locating nubs at the bottom of the socket in mm. Default value of 7 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_nub_offset` | Offset between the front of the socket and the closest locating nub in mm. Default value of 1.5 works for the popular PJ-320A socket. | `parameters.scad` |
| `trrs_plug_width` | Width of the TRRS plug being used, for plate clearance. | `parameters.scad` |

### Standoff Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `standoff_integration_default`,<br>`standoff_attachment_default` | These two parameters define what component standoffs are integrated with and screwed into by default. Individual standoffs can overridde these values via `extra_data`. `standoff_integration_default` can be selected from the set `[plate, backplate, pcb, separate, none]`, while `standoff_attachment_default` comes from the set `[plate, backplate, pcb, plate_backplate, none]`.However, not all combinations are valid. For example, the two parameters cannot be the same (except for `none`), and the `plate_backplate` attachment parameter only works with `separate` standoffs. `separate` standoffs also can't have the `pcb` attachment, as they are attached to the PCB by default, and the parameter specifies the other component they're attached to. | `parameters.scad` |
| `standoff_diameter` | Defines the diameter of generated standoffs. Values greater than 5mm may interfere with plate cutouts if placed between keys. Default value is set for M2 screws. | `parameters.scad` |
| `standoff_clearance_hole_diameter` | Defines the size of through holes for standoff screws. Default value is set for M2 screws. | `parameters.scad` |
| `standoff_pilot_hole_diameter` | Defines the size of pilot holes for standoff screws. This diameter should be sized such that the screw can cut threads into the plastic. Default value is set for M2 screws. | `parameters.scad` |

### Via Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `via_width` | Width of the via (also the diameter of the rounded end). This can be overridden for an individual standoff via `extra_data`. | `parameters.scad` |
| `via_length` | Total length of the via (including the rounded ends). This can be overridden for an individual standoff via `extra_data`. | `parameters.scad` |

### Backplate Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `backplate_thickness` | Defines the thickness of the backplate. | `parameters.scad` |
| `pcb_backplate_spacing` | Defines the distance between the bottom of the PCB and the top of the backplate. Can be decreased for a lower profile or increased for more room to route wires. | `parameters.scad` |

### Misc Parameters:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `fit_tolerance` | This can be used to compensate for print tolerances between the standoffs and the PCB/plate that place them too far apart. Should only be a few tenths of a millimeter at most. | `parameters.scad` |
| `$fn` | This defines the resolution of generated circles. By default this is set to 12 for quick rendering, but you may want to set it to 60 or more when generating your final STLs for more accurate hole shapes. | `parameters.scad` |

### Advanced Parameters
| Name | Description | Location |
| ---- | ----------- | -------- |
| `unit` | Defines the size of "1U" in the layout. | `parameters.scad` |
| `h_unit` | Defines the size of "1U" horizontally. By default this is set to `unit`, but can be changed independently. Horizontal spacing for Choc keycaps is 18mm. | `parameters.scad` |
| `v_unit` | Defines the size of "1U" vertically. By default this is set to `unit`, but can be changed independently. Vertical spacing for Choc keycaps is 17mm. | `parameters.scad` |
| `grid` | Defines the size of the grid used for positioning elements in the MX switch footprint. Shouldn't need to be changed. | `parameters.scad` |
| `socket_size` | Size of the socket footprint for the switch. Shouldn't need to be changed. | `parameters.scad` |
| `socket_depth` | Depth of the holes in the PCB for the switch pins and legs (in mm). 3.5mm should be enough for all the common switch types, but you can increase it if you're hitting the bottom for some reason. Note that this will create more perimeters and increase print time. | `parameters.scad` |
| `plate_thickness` | Defines the thickness of the plate. This is already set for both MX and Choc switches, but can be tweaked for tighter/looser fits or to compensate for print tolerances. Note that these are not multiple of 0.2mm, so if you're printing at a 0.2mm layer height you should set a 0.3mm first layer height for accurate results. | `parameters.scad` |
| `plate_cutout_size` | Defines the size of the plate cutouts. This can be adjusted to compensate for print tolerances or for a tighter/looser fit. | `parameters.scad` |
| `pcb_plate_spacing` | Defines the distance between the PCB and plate (used to calculate standoff length). This is predefined for MX and Choc switches. If you find that the spacing is slightly off, I recommend tweaking the `fit_tolerance` parameter first. | `parameters.scad` |
| `mcu_unit_resolution` | Size of the grid to align the MCU footprint size to (done for ease of layout positioning). Default value of 0.5 seems to work pretty well for the Pro Micro. | `parameters.scad` |
