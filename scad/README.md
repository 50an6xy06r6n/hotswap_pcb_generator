# OpenSCAD Source
`pcb.scad` and `plate.scad` are the files responsible for generating the actual PCB and plate STLs. There's also `diode_bending_template.scad`, which generates a small jig for bending the diode legs repeatably, though the STLs for these are already in the [`stl`](../stl) directory.

 General parameters for the PCB and plate come from `parameters.scad` and layout data comes from `layout.scad`, which is generated by the [conversion script](../script). If `layout.scad` doesn't exist, layout data is taken from `default_layout.scad`, which contains the layout I originally designed this tool for.

 Below are descriptions of all the values that can be customized to suit your needs without breaking the code (I think).

### Customizable Values:
| Name | Description | Location |
| ---- | ----------- | -------- |
| `base_layout` | Defines position, orientation, and size of each key socket, as well as the size of the border that connects each socket to adjacent ones. For each key, the layout looks like this: <pre>[<br/>&nbsp;&nbsp;[x_location, y_location],<br/>&nbsp;&nbsp;[rotation, rotation_x, rotation_y]<br/>],<br/>[<br/>&nbsp;&nbsp;key_size,<br/>&nbsp;&nbsp;[top_border, bottom_border, left_border, right_border],<br/>&nbsp;&nbsp;rotate_column<br/>]</pre>The rotation parameter and the nested vector of socket shape variables is optional. Also note that the border values define multiples of `border_width`, which is calculated from the difference between `socket_size` and `unit`. If you want to define the size of the border in mm, multiply by the `mm` variable, which does the conversion. If you have different vertical and horizontal spacing, use `h_mm` and `v_mm` instead. | `layout.scad` |
| `base_standoff_layout` | Defines the position of each (optional) standoff. Data format is identical to that of `base_layout`, with the standoff placed at the center of the key unit. This makes it means that you can place a standoff in between two keys by just averaging their positions. | `layout.scad` |
| `invert_layout_flag` | If set to true, the layout will be inverted when generating the PCB and plate. This is handy for split layouts with identical left and right hands, as it saves you the trouble of copying over any changes you make to the borders and standoff positions. | `layout.scad` |
| `layout_type` | This can be set to either `column` or `row` (depending on the layout stagger), and affects which side the recessed grid is printed on, which is necessary for routing matrix wires that don't run in a straight line. For row-staggered layouts, the grid will be on the bottom (column-side) of the PCB, so it will be easier to print upside down. | `layout.scad` |
| `wire_diameter` | The diameter of wire (in mm) used for the matrix. The default value of 2.15 works for 22AWG silicone-sleeved wire, which is what I used, but it can be tweaked based on your fit preferences or a different kind of wire. | `parameters.scad` |
| `diode_pin_angle` | This changes the angle of the channel that forms the bottom switch pin socket. The bottom switch pin makes contact the diode anode leg, and the connection can sometimes be a bit flaky. Slightly angling the channel upwards forces the switch pin into the diode leg as it's inserted, and makes for a more robust connection. This can put a slight bend in the switch pin that can be easily bent back (the bottom pin tends to be the sturdier of the two), but if you don't want that you can set the angle to 0. | `parameters.scad` |
| `switch_type` | This can be set to either `mx` or `choc`, depending on the type of switch you plan to use. This changes the PCB cutouts, as well as the plate thickness and spacing used for standoffs. Support for other switch types is possible if I'm able to obtain them. | `parameters.scad` |
| `switch_orientation` | This can be set to either `north` or `south`, and defines the LED orientation of the switch. South-facing offers better compatibility with Cherry-profile keycaps, while north-facing may result in better illumination of shine-through legends. | `parameters.scad` |
| `standoff_type` | This can be set to `plate`, `pcb`, `separate`, or `none`, and defines where standoffs and screw holes will be generated. | `parameters.scad` |
| `standoff_diameter` | Defines the diameter of generated standoffs. Values greater than 5mm may interfere with plate cutouts if placed between keys. Default value is set for M2 screws. | `parameters.scad` |
| `standoff_clearance_hole_diameter` | Defines the size of through holes for standoff screws. Default value is set for M2 screws. | `parameters.scad` |
| `standoff_pilot_hole_diameter` | Defines the size of pilot holes for standoff screws. This diameter should be sized such that the screw can cut threads into the plastic. Default value is set for M2 screws. | `parameters.scad` |
| `pcb_thickness` | Defines the overall thickness of the PCB. This must be at least 4mm, which is the minimum needed to fit both row and column wires. Can be increased if you want a sturdier PCB. | `parameters.scad` |
| `plate_margin` | Defines how far the plate sticks out beyond the PCB. If you wish to have more granular control over the plate shape, you can set this to 0 and generate a separate layout for the plate and edit the borders directly. | `parameters.scad` |
| `fit_tolerance` | This can be used to compensate for print tolerances between the standoffs and the PCB/plate that place them too far apart. Should only be a few tenths of a millimeter at most. | `parameters.scad` |
| `$fn` | This defines the resolution of generated circles. By default this is set to 12 for quick rendering, but you may want to set it to 60 or more when generating your final STLs for more accurate hole sizes. | `parameters.scad` |

### Advanced Values
| Name | Description | Location |
| ---- | ----------- | -------- |
| `unit` | Defines the size of "1U" in the layout. | `parameters.scad` |
| `h_unit` | Defines the size of "1U" horizontally. By default this is set to `unit`, but can be changed independently. Horizontal spacing for Choc keycaps is 18mm. | `parameters.scad` |
| `v_unit` | Defines the size of "1U" vertically. By default this is set to `unit`, but can be changed independently. Vertical spacing for Choc keycaps is 17mm. | `parameters.scad` |
| `grid` | Defines the size of the grid used for positioning elements in the MX switch footprint. Shouldn't need to be changed. | `parameters.scad` |
| `socket_size` | Size of the socket footprint for the switch. Shouldn't need to be changed. | `parameters.scad` |
| `socket_depth` | Depth of the holes in the PCB for the switch pins and legs (in mm). 3.5mm should be enough for all the common switch types, but you can increase it if you're hitting the bottom for some reason. Note that this will create more perimeters and increase print time. | `parameters.scad` |
| `plate_thickness` | Defines the thickness of the plate. This is already set for both MX and Choc switches, but can be tweaked for tighter/looser fits or to compensate for print tolerances. Note that these are not multiple of 0.2mm, so if you're printing at a 0.2mm layer height you should set a 0.3mm first layer height for accurate results. | `parameters.scad` |
| `plate_cutout_size` | Defines the size of the plate cutouts. This can be adjusted to compensate for print tolerances or for a tighter/looser fit. | `parameters.scad` |
| `pcb_plate_spacing` | Defines the distance between the PCB and plate (used to calculate standoff length). This is predefined for MX and Choc switches. If you find that the spacing is slightly off, I recommend tweaking the `fit_tolerance` parameter first. | `parameters.scad` |
