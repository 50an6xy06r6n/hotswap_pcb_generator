# 3D-Printable Hotswap Keyboard PCB Generator
![Example PCB](img/pcb_0.jpg)

This is an OpenSCAD script that can be used to generate 3D-printable hotswap "PCBs" for prototyping new keyboard layouts. I originally wrote this to help me prototype a split ergo layout without needing to solder/desolder all the switches every time. If you're only going to be building the keyboard once, this is probably a lot more work than just handwiring, but it might be useful if you're iterating on a design and want to reuse your switches.

### Usage
The OpenSCAD script reads the layout data from the `layout.scad` header file, which you can either write by hand (the format is described in `default_layout.scad`) or generate from a KLE json file using the provided script:
```
cd script/
npm install
npm start -- <layout json file>
```
Once the basic layout is set there are more values you can tweak to change the footprint of the PCB or add holes for standoff screws. These values are described in a bit more detail below.

### Additional Context
My original design was inspired by [stingray127's handwirehotswap project](https://github.com/stingray127/handwirehotswap), with the key difference being that I wanted to use stranded wire for the row contacts. That design worked pretty well, but I was using diode legs to connect the sockets vertically, and those connections turned out to be pretty flaky. In addition, there was nothing holding the sockets in place besides friction with the switch legs, and when seating switches you had to be pushing up on the socket from the back. I solved these problems by just using another set of wires for the columns and combining all the sockets into a solid plate.

The design uses 22AWG stranded wire for the matrix rows and columns (wire gauge is configurable), with the top switch pin plugging directly into the row wire and the diode cathode sticking through the column wire. The bottom switch pin makes contact with the diode anode, though that connection can be a bit finicky. I've solved this for now by putting a slight angle on the channel that holds the anode leg and switch pin, but it does slightly bend the switch pin in the process. The bend is pretty minor and can be easily bent back, but the angle is configurable for those who don't want to damage their switches. You can also use a bit of aluminum foil to solidify the contact point, but I found that to be too tedious in practice. If you're using silicone wires you might be able to get away with sticking the switch pin directly through the insulation, but I recommend slicing the insulation open with a utility knife for the best results. You will also need to pierce the column wires with a sewing needle to create a path for the diode leg to go through, as they're not rigid enough on their own. Electrical integrity is pretty good overall once the switches are properly seated. Hole sizes and such are tuned to my printer, which isn't the most dimensionally accurate, so you may get a better fit by tweaking the hole sizes slightly. I also recommend generating the final stl with a larger `$fn` value, though it does take a while to finish.

The basic layout format matches the commonly-used Keyboard Layout Editor (KLE) format, and the provided node.js script can convert a KLE json into an SCAD file that is included in the main script as a header. I originally wanted to use the OpenSCAD customizer to do this, but it turns out that doesn't support nested vectors at the moment. There are also a couple of additional parameters on each key in the `layout` array pertaining to the geometry of the PCB that you might want to change. One affects how much the PCB extends past each socket, which allows you to trim off excess on the edges and connect parts that are not directly adjacent (such as thumb clusters). Another allows you to rotate the wire channels for the column wires, which is also useful for wiring parts that don't follow a grid, like thumb clusters. Finally, there's also a `hole_layout` parameter that you can use to add clearance holes for mounting the PCB to a case. The design was originally designed for use with staggered-column or ortholinear layouts, but there is experimental support for staggered-row layouts via the `layout_type` parameter. Note that staggered-row PCBs should be printed upside down for better printability.
